<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyEN</title>
</head>
<body>
<style>
#menu{position: fixed;top: 0;left: 0;z-index: 80;font-size: 38px;
    padding:3px;
    font-family: Arial, Helvetica, sans-serif;
    border: 2px dotted rgba(95, 95, 95, 0.822);}

#func1{
    position: fixed;
    top: 0;
    left: 140px;
    z-index: 10;
    width: 400px;
}
#func2{
    position: fixed;
    top: 0;
    left: 140px;
    z-index: 10;
    width: 400px;
    vertical-align: middle;
}
#func3{
    position: fixed;
    top: 0;
    left: 140px;
    z-index: 10;
    width: 400px;
    vertical-align: middle;
}

#txt{  width: 240px; height:40px ; font-size:16px; ;border: 1px solid red; }
#txt2{ width: 240px; height:40px ; font-size:16px; ;border: 1px solid rgb(17, 0, 255);}

.btn1{ width: 50px;height: 40px;}
.btn2{ width: 100px;height: 40px;}
.btn3{ width: 50px;height: 40px;}

#box1{display: flex;flex-wrap: wrap;font-size: 20px;width: 99%;}
.divbox{display: flex;flex-wrap: wrap;font-size: 20px;width: 99%;}
.word_span{padding: 5px;font-size: 20px;}
.my_input{font-size: 20px;padding: 5px;margin: 15px 9px 15px 0px;width: 99%;}
</style>

<div id="menu" onclick="change_func();">MENU</div>
<table id="func1">
    <tr>
        <td><textarea id="txt"></textarea></td>
        <td><input id="clean_btn"  type="button"  class="btn1" value="清除" onclick="new_data('clean');"></td>
        <td><input id="update_btn" type="button"  class="btn1" value="更新" onclick="new_data('update');"></td>
    </tr>
</table>

<table id="func2">
    <tr>
        <td><input id="search_btn"  type="button" class="btn2" value="搜尋" onclick="search_data(1);"></td>
        <td><input id="search_btn2" type="button" class="btn2" value="Bin" onclick="search_data(2);"></td>
        <td style="width:400px;">.</td>
    </tr>
</table>

<table id="func3">
    <tr>
        <td><textarea id="txt2"></textarea></td>
        <td><input id="copy_btn" type="button"  class="btn3" value="複製" onclick="copy_form();"></td>
    </tr>
</table>


<br><br><br><hr>
<div id="box1"></div>

<br><br>

<script>
var num = 1
var newWordnum = 1
var divbox_num = 1
var txt2 = document.getElementById("txt2")
var box1 = document.getElementById("box1")
var search_key = ""

var current_func = 1
var func1 = document.getElementById("func1")
var func2 = document.getElementById("func2")
var func3 = document.getElementById("func3")
func2.style.display = "none";
func3.style.display = "none";

function create_div(){
    divbox_num = divbox_num + 1
    divbox_id = `divbox${divbox_num}`
    const div  = document.createElement("div")    
    div.setAttribute("id",divbox_id)
    div.setAttribute("class", "divbox")
    box1.appendChild(div);
}


function create_input(){
    const div  = document.createElement("div")    
    const div2 = document.createElement("div")

    num = num + 1
    new_id = `input${num}`
    const newInput = document.createElement("input")
    newInput.setAttribute("type" ,"text")
    newInput.setAttribute("id",new_id)
    newInput.setAttribute("class", "my_input")

    divbox_id = `divbox${divbox_num}`
    const mybox = document.getElementById(divbox_id)

    mybox.appendChild(div);
    mybox.appendChild(newInput);    
    mybox.appendChild(div2);
}


// 插入單字
function create_word(word){
    const newWord = document.createElement("span");
    newWordnum = newWordnum + 1
    newWord_id = `newWordId${newWordnum}`
    newWord.setAttribute("id"       ,newWord_id)
    newWord.setAttribute("class"   ,"word_span")
    newWord.setAttribute("onclick" ,`quick_search('${newWord_id}','${word}')`)
    newWord.innerHTML = word
    divbox_id  = `divbox${divbox_num}`    
    const mybox = document.getElementById(divbox_id)
    mybox.appendChild(newWord);
}


function get_txt(){
    let data = document.getElementById("txt").value;
    data.split("\n").forEach(line => {
        line = line.replaceAll(".","").replaceAll("  "," ").replaceAll("  "," ").replaceAll("  "," ").replaceAll("  "," ").replaceAll("  "," ")

        if( line !== ""){
            // 建立 div
            create_div();

            // 插入單字
            line.split(" ").forEach(word => { create_word(word) })

            //插入 Input 匡
            if( line.split(" ").length -1 >= 2 ){
                create_input();}
        }
    });
}

function new_data(my_flag){

    if (my_flag == 'clean'){
        txt.value = ""
        box1.innerHTML=""
    }
    if (my_flag == 'update'){
        box1.innerHTML=""
    }
    get_txt()
}

function search_data(myflag){
    if( search_key != ""){
        if(myflag == 1){
            window.open(`https://www.google.com/search?q=${search_key}單字發音解釋與使用方式`, "_blank") }
        if(myflag == 2){
            window.open(`https://www.bing.com/search?q=${search_key}單字發音解釋與使用方式&qs=n`, "_blank") }
    }
}


function quick_search(newWord_id, word){
    word = word.replace(/[^a-zA-Z]/g, '')
    search_key = word
    document.getElementById("search_btn").value = word

    // 點選文字後, 加入記憶框框內
    let all_string = txt2.value
    if(   func3.style.display != "none" ){
        if (txt2.value.split(" ").indexOf(search_key) > -1){
            all_string = all_string.replace(search_key,"").replaceAll("  "," ").replaceAll("  "," ")
            document.getElementById(newWord_id).style.color = "black"
        }else{
            all_string = `${all_string} ${search_key}`
            document.getElementById(newWord_id).style.color = "blue"
        }
        txt2.value = all_string
    }
}

function copy_form(){
    txt2.select();
    txt2.setSelectionRange(0, 99999); // For mobile devices
    document.execCommand("copy"); // Execute the copy command
}

function change_func(){
    current_func = current_func + 1
    if( current_func == 4 ){ current_func = 1;}
    func1.style.display = "none";
    func2.style.display = "none";
    func3.style.display = "none";
    document.getElementById(`func${current_func}`).style.display = ""
}


</script>




</body>
</html>